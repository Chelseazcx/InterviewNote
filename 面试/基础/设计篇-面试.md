# 设计篇-面试

以前的项目中遇到的问题和解决策略？

生活中遇到过哪些挫折？最后怎么解决的?

谈谈对阿里的哪些开源项目有所了解？

- 服务框架 Dubbo
- 开源数据库 AliSQL：AliSQL 是基于 MySQL 官方版本的一个分支，由阿里云数据库团队维护，目前也应用于阿里巴巴集团业务以及阿里云数据库服务。
- spring-boot-starter-dubbo：可以无缝地对接 spring boot 和 dubbo ，方便大家使用 dubbo 组件。

对淘宝技术是否有了解？

对其杭州信息平台事业部其主要业务是否了解？

原来科研不相关，为什么做java？

让你来设计一个 Spring 框架你会怎么做？

- IOC容器统一管理bean
- AOP切面
- 提供了一致的事务管理接口
- 设计良好的Web MVC框架
- 使用注解代替繁琐的配置
- 设计强大的容器，内嵌应用服务器

如果让你来设计一个springcloud 框架你会怎么做？

- 服务治理
  - 注册与发现：eureka，zookeeper
  - 服务调用：断路器，负载均衡
- 服务路由和过滤：
  - cookie和http header
  - 路径映射
  - 动态路由
- 分布式链路监控
  - 埋点和发送
  - 收集和展示
- 消息
  - 分组和分片
  - 服务事件通信，刷新配置
- 配置中心管理
  - git，配置加解密，密钥管理
- 安全控制
  - 单点登录
  - 资源授权
- 集群工具：分布式锁，一次性令牌
- 命令和脚本管理微服务，组件

springboot优点？

- 优点快速开发
- 封装了各种经常使用的套件，比如mybatis、redis、swagger
- 方便对外输出各种形式的服务，如 REST API、WebSocket、Web、Streaming、Task
- 自动管理依赖
- 自带应用监控
- 支持各种 IED，如 IntelliJ IDEA
- 支持关系数据库和非关系数据库
- 支持运行期内嵌容器，如 Tomcat、Jetty
- 强大的开发包，支持热启动

缺点是集成度较高，使用过程中不太容易了解底层。

微服务优点？

敏捷开发，自动化部署

- 服务组件化，对服务组件分解，每个服务独立开发，部署；
- 按业务组织团队
- 服务交互高效性，RESTFUL api ，消息总线RabbitMQ可靠异步交换的中间件
- 去中心化，集中心化每个技术都有短板，成为系统的瓶颈。
- 基础设施自动化：部署和测试
- 容错设计，部分服务出现故障，其他服务可正常运行

如果让你来设计一个消息队列框架你会怎么做？

- 消息队列的可伸缩性
- 消息队列持久性
- 数据可靠性：事务，应答机制，保存到本地磁盘后应答，消费应答。

如果让你来设计一个 MyBatis 框架你会怎么做？

- 配置，约定大于配置
- 接口层：增删改查，动态更改配置(动态代理)
- 支持多种数据类型的输入
- 注解、xml文件映射，sql解析
- 保证事务
- 数据库连接池
- 记录日志
- 缓存

如果让你来设计一个 redis框架你会怎么做？

- 存放多种数据类型，string，int ，float，hash，set，list
- 持久化：多种方式持久化，保证可靠性
- 数据淘汰：缓存容量满了之后，采用定期缓存+惰性缓存+数据淘汰
- 读取数据的速度快：IO多路复用+内存存放数据
- 高可用性：主从模式，哨兵监控，集群模式
- 幂等性

如果让你来设计一个 秒杀框架你会怎么做？


- 系统拆分：springboot单服务器高可用性低，使用springcloud拆分多个子系统。

  - springcloud：

    eureka服务端注册发现，eureka客户端：服务提供者，服务调用者。

    Rabbion负载均衡，Hystrix断路器。

    在秒杀前做好足够的准备：Hystrix dashbroad监控面板和聚合turbine，链路跟踪 Sleuth + Zipkin 

- MQ：特点：削峰，异步，解耦

  削峰：原本秒杀期间所有的用户访问直接请求到服务端。使用后，让所有的请求写入mq，然后由mq队列分发消息，配合负载均衡策略，可以分发到分布式服务端。

  异步：大量用户访问，先返回一个响应，然后由mq再将消息分发，最后返回回调内容。

  缺点：系统可用性降低，依赖越多，越容易挂掉；系统复杂性提高，消息重复消费，消息可靠性，消息积压，如果对消息顺序性敏感


- 缓存：大部分用户读多写少，10w的qps，查询速度快，读的时候大量请求从缓存取。快的原因：内存，IO多路复用，没有多线程竞争。

  为了保证缓存的高可用性，设计主从模式和集群模式，使用哨兵监视。原生集群有一整套方式保证高可用性

  缺点：缓存和数据库不一致，缓存雪崩，穿透，并发竞争。

- Mysql：

  分库分表：单表数据量不超过200w，单库并发访问1000/s，超过2000/s报警。

  读写分离-主从复制：一个主库，多个从库。binlog方式数据同步。

  存在问题：**半同步复制**，用来解决主库数据丢失问题； **并行复制** ，用来解决主从同步延时问题。

  分表分库中间件：mycat，mysql router管理

- 解决超卖问题：分布式锁，带版本号的乐观锁更新，FIFO队列。

开源框架的具体底层实现，springboot，springcloud源码？

- DispatcherServlet启动，作为核心管理器响应处理流程
- springboot启动，源码
- springcloud Ribbon负载均衡源码，Hystrix断路器源码



